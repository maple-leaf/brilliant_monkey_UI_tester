# 技术方案

## 系统组成部分
1. 前端交互模块 - 负责页面访问，页面交互，页面截图
2. 交互工厂模块 - 使用或不使用 AI 来预测和产生下一个交互动作
3. 结果评判模块 - 使用像素对比或 AI 来进行结果正确性的判断

## 前端交互模块

### 功能定义

使用无头 Chrome 浏览器来进行被测试页面的访问、分析、交互，并将产生的结果截图。

### 访问与分析
页面被访问后有初始化的各种过程，本模块会使用 lighthouse 记录和分析页面载入时间、页面可交互时间、资源加载统计等。

### 交互
使用 puppeteer 提供的 API 操作无头 Chrome 进行相应的交互行为，如点击、键盘输入、拖拽等。

### 交互结果截图
使用 puppeteer 提供的 API 操作无头 Chrome 在交互完成后并产生一定结果后截图，以此作为当次交互产生的结果图。
交互结果可能有以下三种情况：
1. 无效交互，即本次交互不产生任何 UI 方面的影响。
2. 同步交互，即本次交互对 UI 产生了影响，且和 UI 变化是实时同步的。
3. 异步交互，即本次交互对 UI 产生了影响，但是影响是在一定的延迟后产生的。延迟可能产生的原因有代码执行时延，网络请求时延等。
交互结果截图无论是上面哪种情况，都应该保证结果图能正确的反馈交互的影响。

## 交互工厂模块

### 功能定义

根据之前的交互结果预测和产生下一次前端交互模块应该采取的交互行为。

### 预测

## 以 puppeteer 调用无头 Chrome 浏览器对被测试页面进行一次随机测试为例

1. 无头 Chrome 访问被测试页面地址，进行页面分析和初始截图
2. 交互工厂产生一次交互动作定义提交给前端交互模块
3. 前端交互模块在无头 Chrome 内触发交互动作
4. 前端交互模块将这次动作产生的结果截图
